<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8"/>
    <title>Presupuesto</title>
    <style type="text/css">
        @page {
            size: A4;
            margin: 0;
        }
        
        body {
            margin: 0;
            padding: 20mm;
            background-color: #ffffff;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 10pt;
            color: #000000;
        }

        /* --- ENCABEZADO --- */
        table.header-table {
            width: 100%;
            border-collapse: collapse;
            border: none;
            table-layout: fixed;
            margin-bottom: 10px;
        }

        /* Columna Logo */
        td.logo-cell {
            width: 160px; /* Ancho reservado */
            vertical-align: middle; /* Centrado vertical */
            padding: 0;
            height: 100px; 
        }

        /* ESTILO PARA BASE64 */
        img.logo-img {
            /* Forzamos el tamaño para que Flying Saucer no se confunda */
            width: 150px;
            height: auto; /* Mantiene la proporción */
            display: block;
        }

        /* Columna Datos */
        td.info-cell {
            vertical-align: top;
            text-align: right;
        }

        .company-name { font-weight: bold; font-size: 12pt; text-transform: uppercase; margin-bottom: 5px; }
        .rfc { font-weight: bold; display: block; margin-bottom: 5px; }
        .info-text { margin-bottom: 2px; line-height: 1.2; }

        .yellow-bar {
            width: 100%;
            height: 6px;
            background-color: #FFFF00;
            margin-bottom: 20px;
            font-size: 0;
        }

        /* --- DATOS CLIENTE --- */
        table.meta-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 25px;
        }
        
        td.date-data { 
            text-align: right; 
            font-weight: bold; 
            padding-bottom: 15px;
        }

        td.client-data { 
            vertical-align: top; 
            text-align: left; 
        }

        .client-name { 
            font-weight: bold; 
            text-transform: uppercase; 
            display: block; 
            font-size: 11pt;
            margin-bottom: 5px;
        }

        .client-intro {
            font-size: 10pt;
            line-height: 1.4;
            color: #000;
            /* Texto libre para reemplazar el "PRESENTE, PRESENTE" */
        }

        /* --- TABLA PRODUCTOS --- */
        h2.doc-title {
            text-align: center;
            font-size: 14pt;
            font-weight: bold;
            text-transform: uppercase;
            margin: 10px 0;
            letter-spacing: 2px;
        }

        .currency { text-align: right; font-size: 8pt; margin-bottom: 2px; }

        table.items-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #000000;
        }

        table.items-table th {
            background-color: #cccccc;
            border: 1px solid #000000;
            padding: 5px;
            font-weight: bold;
            text-align: center;
            font-size: 9pt;
        }

        table.items-table td {
            border: 1px solid #000000;
            padding: 4px;
            font-size: 9pt;
        }

        .col-cant { width: 10%; text-align: center; }
        .col-desc { width: 60%; text-align: left; }
        .col-unit { width: 15%; text-align: right; }
        .col-imp  { width: 15%; text-align: right; }

        /* --- TOTALES --- */
        table.totals-table {
            width: 100%;
            border: none; 
            margin-top: 10px;
        }

        .totals-label { font-weight: bold; text-align: right; }
        .totals-value { text-align: right; width: 100px; }

    </style>
</head>
<body>

    <table class="header-table">
        <tr>
            <td class="logo-cell">
                <img src="{{Imagen_URL}}" class="logo-img" alt="Logo" />
            </td>
            
            <td class="info-cell">
                <div class="company-name">{{nombre_emisor}}</div>
                <span class="rfc">R.F.C {{rfc_emisor}}</span>
                <div class="info-text">Régimen Fiscal: {{regimen_fiscal}}</div>
                <div class="info-text">Domicilio Fiscal: {{direccion_fiscal}}</div>
                <div class="info-text">{{ciudad_estado_cp}}</div>
            </td>
        </tr>
    </table>

    <div class="yellow-bar">&nbsp;</div>

    <table class="meta-table">
        <tr>
            <td colspan="2" class="date-data">
                {{lugar_y_fecha}}
            </td>
        </tr>
        <tr>
            <td class="client-data">
                <span class="client-name">{{nombre_cliente}}</span>
                <div class="client-intro">
                    {{texto_introductorio_cliente}}
                </div>
            </td>
            <td>&nbsp;</td>
        </tr>
    </table>

    <h2 class="doc-title">PRESUPUESTO</h2>
    <div class="currency">Moneda: MXN – peso mexicano</div>

    <table class="items-table">
        <thead>
            <tr>
                <th class="col-cant">CANTIDAD</th>
                <th class="col-desc">CONCEPTO</th>
                <th class="col-unit">P. UNITARIO</th>
                <th class="col-imp">IMPORTE</th>
            </tr>
        </thead>
        <tbody>
            {{#partidas}}
            <tr>
                <td class="col-cant">{{cantidad}}</td>
                <td class="col-desc">{{descripcion}}</td>
                <td class="col-unit">{{precio_unitario}}</td>
                <td class="col-imp">{{importe}}</td>
            </tr>
            {{/partidas}}
            
            {{^partidas}}
            <tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
            <tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
            <tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
            <tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
            {{/partidas}}
        </tbody>
    </table>

    <table style="width: 100%; border: none; margin-top: 10px;">
        <tr>
            <td style="width: 60%; border: none;">&nbsp;</td>
            
            <td style="width: 40%; border: none; padding: 0;">
                <table style="width: 100%; border-collapse: collapse;">
                    <tr>
                        <td class="totals-label" style="border: none;">SUBTOTAL:</td>
                        <td class="totals-value" style="border: none;">$ {{subtotal}}</td>
                    </tr>
                    <tr>
                        <td class="totals-label" style="border: none;">IVA (16%):</td>
                        <td class="totals-value" style="border: none;">$ {{iva}}</td>
                    </tr>
                    <tr>
                        <td class="totals-label" style="border: none;">TOTAL:</td>
                        <td class="totals-value" style="border: none;">$ {{total_final}}</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>

</body>
</html>